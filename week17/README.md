# 第十六次作业

## 要求

### 补完打赏流程

整个打赏流程，还有一些问题需要你处理。

支付消息必然发送成功。也就是在 Payment 收到了微信支付的回调之后，会更新本地状态，而后发一个消息到 Kafka 上。现在要求你设计一个兜底机制，确保这个消息一定会发送成功，参考思路本地消息表。
记账的幂等性。你可以注意到，在 Reward 收到支付成功的消息之后，就会要求记账服务记账，现在要求你设计提供一个方案，保证同一个 biz+bizId，不会重复记账。并且要考虑有什么优化方案，可以进一步提高性能。参考唯一索引、Redis 去重、布隆过滤器等。
设计服务治理措施。考虑在整个流程的不同部分引入一些服务治理手段，你可以自由发挥。
三者对账机制。整个机制涉及到了打赏 - 支付 - 记账三个服务，现在要求你设计一个机制，能够对比三者的数据，并且找出不一致的数据。
你有两周的时间，从四个里面挑选出来两个，提供代码实现。剩下的两个只需要提供思路，确保这个思路能够在面试中顶住面试官的追问。